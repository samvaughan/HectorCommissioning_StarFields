
######## snakemake preamble start (automatically inserted, do not edit) ########
import sys; sys.path.extend(['/opt/anaconda3/envs/snakemake/lib/python3.9/site-packages', '/Users/samvaughan/Science/Hector/Targets/HectorInputCatalogues/Commissioning/StarFields/workflow/scripts']); import pickle; snakemake = pickle.loads(b'\x80\x04\x95]\r\x00\x00\x00\x00\x00\x00\x8c\x10snakemake.script\x94\x8c\tSnakemake\x94\x93\x94)\x81\x94}\x94(\x8c\x05input\x94\x8c\x0csnakemake.io\x94\x8c\nInputFiles\x94\x93\x94)\x81\x94(\x8c\x19config/Field_240_m20.yaml\x94\x8c-results/Mosaics/Panstarrs_Mosiac_240_m20.fits\x94e}\x94(\x8c\x06_names\x94}\x94(\x8c\x0fconfig_filename\x94K\x00K\x01\x86\x94\x8c\x0binput_image\x94K\x01K\x02\x86\x94u\x8c\x12_allowed_overrides\x94]\x94(\x8c\x05index\x94\x8c\x04sort\x94eh\x15\x8c\tfunctools\x94\x8c\x07partial\x94\x93\x94h\x06\x8c\x19Namedlist._used_attribute\x94\x93\x94\x85\x94R\x94(h\x1b)}\x94\x8c\x05_name\x94h\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bh\x0fh\x06\x8c\tNamedlist\x94\x93\x94)\x81\x94h\na}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bubh\x11h&)\x81\x94h\x0ba}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bubub\x8c\x06output\x94h\x06\x8c\x0bOutputFiles\x94\x93\x94)\x81\x94(\x8c5results/SkyMasks/Mosaic/segmap_StarField_240_-22.fits\x94\x8c9results/ProfoundCatalogues/profound_catalogue_240_-22.csv\x94e}\x94(h\r}\x94(\x8c\rprofound_mask\x94K\x00K\x01\x86\x94\x8c\x12profound_catalogue\x94K\x01K\x02\x86\x94uh\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bhGh&)\x81\x94hCa}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bubhIh&)\x81\x94hDa}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bubub\x8c\x06params\x94h\x06\x8c\x06Params\x94\x93\x94)\x81\x94}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bub\x8c\twildcards\x94h\x06\x8c\tWildcards\x94\x93\x94)\x81\x94}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bub\x8c\x07threads\x94K\x01\x8c\tresources\x94h\x06\x8c\tResources\x94\x93\x94)\x81\x94(K\x01K\x01e}\x94(h\r}\x94(\x8c\x06_cores\x94K\x00N\x86\x94\x8c\x06_nodes\x94K\x01N\x86\x94uh\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bh\x91K\x01h\x93K\x01ub\x8c\x03log\x94h\x06\x8c\x03Log\x94\x93\x94)\x81\x94}\x94(h\r}\x94h\x13]\x94(h\x15h\x16eh\x15h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x15sNt\x94bh\x16h\x19h\x1b\x85\x94R\x94(h\x1b)}\x94h\x1fh\x16sNt\x94bub\x8c\x06config\x94}\x94(\x8c\x05FIELD\x94K\xf0\x8c\tcentre_ra\x94K\xf0\x8c\ncentre_dec\x94J\xea\xff\xff\xff\x8c\x17star_catalogue_width_ra\x94K\x01\x8c\x18star_catalogue_width_dec\x94K\x01\x8c\x1efinal_star_catalogue_name_stem\x94\x8c\x1cPanstarrs_match_Gaia_240_m20\x94\x8c\x15date_for_observations\x94\x8c\n2021-07-10\x94\x8c\x15individual_image_glob\x94\x8c;/Volumes/OtherFiles/Science/Panstarrs_Mosaic/240_m22/*.fits\x94\x8c\x14final_image_filename\x94\x8c%Mosaics/Panstarrs_Mosiac_240_m20.fits\x94\x8c\x17image_resolution_arcsec\x94G?\xf8\x00\x00\x00\x00\x00\x00\x8c\x12profound_mask_name\x94\x8cZ/Volumes/OtherFiles/Science/Panstarrs_Mosaic/SkyMasks/Mosaic/segmap_StarField_240_-22.fits\x94\x8c\x17profound_catalogue_name\x94\x8c1ProfoundCatalogues/profound_catalogue_240_-22.csv\x94\x8c\x11profound_zero_mag\x94G@8\xc2\x8f\\(\xf5\xc3\x8c\tSourceCat\x94\x8c\x14240_m20_comissioning\x94\x8c\x14final_catalogue_name\x94\x8c\x7f~/Science/Hector/Targets/HectorInputCatalogues/Commissioning/StarFields/StarCatalogues/Panstarrs_match_Gaia_240_m20_targets.csv\x94\x8c\x13guide_star_filename\x94\x8c~~/Science/Hector/Targets/HectorInputCatalogues/Commissioning/StarFields/StarCatalogues/Panstarrs_match_Gaia_240_m20_guides.csv\x94\x8c\x16standard_star_filename\x94\x8c\x81~/Science/Hector/Targets/HectorInputCatalogues/Commissioning/StarFields/StarCatalogues/Panstarrs_match_Gaia_240_m20_standards.csv\x94\x8c\x14output_filename_stem\x94\x8c\x14240_m20_comissioning\x94\x8c\routput_folder\x94\x8c\x15TilingOutputs/240_m20\x94\x8c\x0bfresh_start\x94\x88\x8c\tMAX_TRIES\x94M\xe7\x03\x8c\x0fconfigure_field\x94\x88\x8c\x0btiling_type\x94\x8c\x06greedy\x94\x8c\x0fallocation_type\x94\x8c\x06random\x94\x8c\tproximity\x94K\xdc\x8c\x04Nsel\x94K\x13\x8c\x1aN_targets_per_Hector_field\x94K\x13\x8c\x0bNsel_guides\x94Kd\x8c\x0eNsel_standards\x94Kd\x8c\x10TwoDF_FOV_radius\x94G?\xf0\x00\x00\x00\x00\x00\x00\x8c\x0eexclusion_zone\x94K\xdc\x8c\x17Hector_FOV_outer_radius\x94G?\xed\xd1N;\xcd5\xa8\x8c\x17Hector_FOV_inner_radius\x94G\x00\x00\x00\x00\x00\x00\x00\x00\x8c\x15fraction_to_reobserve\x94G\x00\x00\x00\x00\x00\x00\x00\x00\x8c\x11Rescale_proximity\x94\x88\x8c\x18fill_spares_with_repeats\x94\x88\x8c\x1ecolumns_for_target_tile_saving\x94]\x94(\x8c\x02ID\x94\x8c\x02RA\x94\x8c\x03DEC\x94\x8c\x05g_mag\x94\x8c\x05r_mag\x94\x8c\x05i_mag\x94\x8c\x05z_mag\x94\x8c\x05y_mag\x94\x8c\nGAIA_g_mag\x94\x8c\x0bGAIA_bp_mag\x94\x8c\x0bGAIA_rp_mag\x94\x8c\x04pmRA\x94\x8c\x05pmDEC\x94\x8c\x02Re\x94\x8c\nGAL_MU_E_R\x94\x8c\x05Mstar\x94e\x8c\x1dcolumns_for_guide_tile_saving\x94]\x94(\x8c\x02ID\x94\x8c\x02RA\x94\x8c\x03DEC\x94\x8c\x05r_mag\x94\x8c\x04type\x94\x8c\x04pmRA\x94\x8c\x05pmDEC\x94eu\x8c\x04rule\x94\x8c\x16run_profound_on_mosaic\x94\x8c\x0fbench_iteration\x94N\x8c\tscriptdir\x94\x8ch/Users/samvaughan/Science/Hector/Targets/HectorInputCatalogues/Commissioning/StarFields/workflow/scripts\x94ub.'); from snakemake.logging import logger; logger.printshellcmds = False; __real_file__ = __file__; __file__ = '/Users/samvaughan/Science/Hector/Targets/HectorInputCatalogues/Commissioning/StarFields/workflow/scripts/run_profound_mosaic.py';
######## snakemake preamble end #########
import numpy as np
import matplotlib.pyplot as plt
import subprocess
from pathlib import Path
import yaml
import argparse
import shlex

# parser = argparse.ArgumentParser()
# parser.add_argument("Config_filename")
# args = parser.parse_args()

# config_filename = Path(args.Config_filename)

# with open(config_filename, 'r') as stream:
#     try:
#         config = yaml.safe_load(stream)
#     except yaml.YAMLError as exc:
#         print(exc)

input_image = snakemake.input.input_image[0]
output_mask = snakemake.output.profound_mask[0]
output_catalogue = snakemake.output.profound_catalogue[0]
zeromag = snakemake.config['profound_zero_mag']

bash_command = f'workflow/scripts/profound_r_script.R {input_image} {output_mask} {output_catalogue} --mag_zero {zeromag}'

print("Running Profound...")
subprocess.check_call(shlex.split(bash_command))
print("Done!")